var game;!function(e){var t=function(t){function i(){t.call(this),this.EffectFrameRate=24,this.GlobalFrameRate=60,this.gap=0,this.init(),this.currentPlayingEffects={}}__extends(i,t);var s=(__define,i),n=s.prototype;return n.init=function(){this.playSpeed=this.GlobalFrameRate/this.EffectFrameRate,this.effects={},this.initTestEffect()},n.initTestEffect=function(){var t;t=new e.EffectVo,t.id=1,t.res="sp.great",t.sound="great1_mp3",t.phases={};var i=new e.PhaseVo;i.index=0,i.type="tween",i.fx=100,i.fy=688,i.tx=160,i.ty=325,i.fa=0,i.ta=1,i.fscl=.2,i.tscl=1,i.frameCnt=6,t.phases[i.index]=i,i=new e.PhaseVo,i.index=1,i.type="stay",i.fx=160,i.fy=325,i.frameCnt=10,t.phases[i.index]=i,i=new e.PhaseVo,i.index=2,i.type="tween",i.fx=160,i.fy=325,i.tx=160,i.ty=100,i.fa=1,i.ta=0,i.frameCnt=6,t.phases[i.index]=i,t.totalPhase=3,this.effects[t.id]=t,t=new e.EffectVo,t.id=2,t.res="sp.niubility",t.sound="niubility_mp3",t.phases={};var i=new e.PhaseVo;i.index=0,i.type="tween",i.fx=100,i.fy=688,i.tx=125,i.ty=325,i.fa=0,i.ta=1,i.fscl=.2,i.tscl=1,i.frameCnt=6,t.phases[i.index]=i,i=new e.PhaseVo,i.index=1,i.type="stay",i.fx=125,i.fy=325,i.frameCnt=7,t.phases[i.index]=i,i=new e.PhaseVo,i.index=2,i.type="tween",i.fx=125,i.fy=325,i.tx=125,i.ty=150,i.fa=1,i.ta=0,i.frameCnt=6,t.phases[i.index]=i,t.totalPhase=3,this.effects[t.id]=t,t=new e.EffectVo,t.id=0,t.res="sp.nici",t.sound="nice_mp3",t.phases={};var i=new e.PhaseVo;i.index=0,i.type="tween",i.fx=120,i.fy=688,i.tx=175,i.ty=325,i.fa=0,i.ta=1,i.fscl=.2,i.tscl=1,i.frameCnt=6,t.phases[i.index]=i,i=new e.PhaseVo,i.index=1,i.type="stay",i.fx=175,i.fy=325,i.frameCnt=7,t.phases[i.index]=i,i=new e.PhaseVo,i.index=2,i.type="tween",i.fx=175,i.fy=325,i.tx=175,i.ty=150,i.fa=1,i.ta=0,i.frameCnt=6,t.phases[i.index]=i,t.totalPhase=3,this.effects[t.id]=t,t=new e.EffectVo,t.id=3,t.res="sp.amazing",t.sound="amazing_mp3",t.phases={};var i=new e.PhaseVo;i.index=0,i.type="tween",i.fx=100,i.fy=688,i.tx=130,i.ty=325,i.fa=0,i.ta=1,i.fscl=.2,i.tscl=1,i.frameCnt=6,t.phases[i.index]=i,i=new e.PhaseVo,i.index=1,i.type="stay",i.fx=130,i.fy=325,i.frameCnt=7,t.phases[i.index]=i,i=new e.PhaseVo,i.index=2,i.type="tween",i.fx=130,i.fy=325,i.tx=130,i.ty=100,i.fa=1,i.ta=0,i.frameCnt=6,t.phases[i.index]=i,t.totalPhase=3,this.effects[t.id]=t},n.playEffect=function(e){var t=this.effects[e];null!=t&&(t.reset(),t.nextStep())},n.nextStep=function(){var e;for(var t in this.currentPlayingEffects)e=this.currentPlayingEffects[t],e.isEnded()?delete this.currentPlayingEffects[t]:e.nextStep()},n.onEnterFrame=function(e){this.gap++,this.gap>=this.playSpeed&&(this.nextStep(),this.gap=0)},n.parseEffects=function(e){},n.setEffectContainer=function(e){this.effectCon=e},n.addIcon=function(e){this.effectCon.addChild(e)},n.removeIcon=function(e){e.parent==this.effectCon&&this.effectCon.removeChild(e)},i.instance=function(){return null==i._instance&&(i._instance=new e.EffectMgr),i._instance},i}(egret.HashObject);e.EffectMgr=t,egret.registerClass(t,"game.EffectMgr")}(game||(game={}));var game;!function(e){var t=function(t){function i(){t.call(this),this.isEnd=!1}__extends(i,t);var s=(__define,i),n=s.prototype;return n.parse=function(t){this.id=t.id,this.res=t.res,this.phases={};var i;for(var s in t.phases)i=new e.PhaseVo,i.parse(t.phases[s]),this.phases[i.index]=i,0==i.index&&(this.currentPhase=i)},n.nextStep=function(){if(this.currentPhaseIndex++,0==this.currentPhaseIndex&&null!=this.sound&&SoundMgr.getInstance().playEffect(this.sound),this.currentPhase=this.phases[this.currentPhaseIndex],null!=this.currentPhase)if(null==this.icon&&this.getRes(),null==this.icon.parent&&e.EffectMgr.instance().addIcon(this.icon),"tween"==this.currentPhase.type){var t=1e3*this.currentPhase.frameCnt/24,i=egret.Tween.get(this.icon);this.currentPhase.initDis(this.icon);var s=this.currentPhase.getTweenProps();i.to(s,t).call(this.nextStep,this)}else"stay"==this.currentPhase.type&&(t=1e3*this.currentPhase.frameCnt/24,egret.setTimeout(this.nextStep,this,t));else this.isEnd=!0,null!=this.icon&&null!=this.icon.parent&&e.EffectMgr.instance().removeIcon(this.icon)},n.reset=function(){this.currentPhaseIndex=-1,this.currentPhase=null,this.isEnd=!1},n.isEnded=function(){return this.isEnd},n.getRes=function(){return null==this.icon&&(this.icon=e.GetBitmap(this.res)),this.icon},i}(egret.HashObject);e.EffectVo=t,egret.registerClass(t,"game.EffectVo")}(game||(game={}));var EList=function(e){function t(){e.call(this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.setData=function(e){},t}(egret.DisplayObjectContainer);egret.registerClass(EList,"EList");var game;!function(e){var t=function(t){function i(){t.call(this)}__extends(i,t);var s=(__define,i);s.prototype;return i.getInstance=function(){return null==i._instance&&(i._instance=new e.EventController),i._instance},i.LOW_FRAMERATE="low_framerate",i.BLOOD_CHANGED="blood_changed",i.ITEM_CHANGED="item_changed",i.CANCEL_ITEM_SELECT="cancel_item_select",i.ITEM_USE="item_use",i.FAIL="fail",i}(egret.EventDispatcher);e.EventController=t,egret.registerClass(t,"game.EventController")}(game||(game={}));var game;!function(e){var t=function(){function e(){}var t=(__define,e);t.prototype;return e.ParticlTetureConfig=[1,2,3,4,5,6,2,8,5,3,1,2,3,4,5,6,2,8,5,3],e.GameId=100049366,e.GameName="数字求合体",e}();e.GameConst=t,egret.registerClass(t,"game.GameConst")}(game||(game={}));var game;!function(e){var t=function(t){function i(){t.call(this),this.row=5,this.col=5,this.startX=70,this.startY=330,this.unitMap={},this.score=0,this.blood=5,this.result=0,this.curMax=0,this.curSeed=5,this.deleteArr=[],this.gap=6,this.cnt=0,this.fillMap={},this.fillArr=[],this.currentFrame=1,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddedToStage,this),this.bg2=new egret.Bitmap(RES.getRes("bg_bottom_02")),this.addChild(this.bg2),this.bg2.y=this.startY-90,this.levelLabel=new egret.BitmapText,this.levelLabel.font=RES.getRes("gold_fnt_fnt"),this.levelLabel.textAlign="center",this.levelLabel.text="0",this.levelLabel.width=180,this.levelLabel.x=150,this.levelLabel.y=60,this.addChild(this.levelLabel),this.scoreLabel=new egret.BitmapText,this.scoreLabel.font=RES.getRes("white_fnt_fnt"),this.scoreLabel.textAlign="center",this.scoreLabel.text="0",this.scoreLabel.width=200,this.scoreLabel.x=140,this.scoreLabel.y=100,this.addChild(this.scoreLabel);var e=new egret.Bitmap(RES.getRes("blood_01"));e.x=480-e.width>>1,e.y=150,this.addChild(e),this.bloodItems=[];for(var i,s=0;5>s;s++)i=new egret.Bitmap(RES.getRes("blood_02")),i.scale9Grid=new egret.Rectangle(15,15,1,1),i.x=20+89*s,i.y=165,this.addChild(i),this.bloodItems.push(i);this.showGuide()}__extends(i,t);var s=(__define,i),n=s.prototype;return n.onAddedToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddedToStage,this),null==this._unitCache&&(this._unitCache=[],this.StageH=this.stage.stageHeight,this.StageW=this.stage.stageWidth,this.initGame())},n.onFail=function(){this.statisticMap={};var e,t,i;for(t in this.unitMap)i=this.unitMap[t],e=i.getValue(),null==this.statisticMap[e]&&(this.statisticMap[e]=[]),this.statisticMap[e].push(t);this.doScoreStatistic()},n.doScoreStatistic=function(){var t,i,s,n,a,r,h=e.GameUnit.UNIT_WIDTH;this.isOver=!0,this.score=this.score,this.scoreLabel.text=e.GetNumString(this.score);var o;for(o in this.statisticMap){i=this.statisticMap[o],t=i.length;for(var l=0;t>l;l++)n=10*parseInt(o),r=this.unitMap[i[l]],s=i[l].split("_"),this.score+=n,e.ShakeMgr.instance().addShakeItem(r.name,{gap:5,cnt:5,dis:r,ox:parseInt(s[0])*h,type:"shakeh"});a=!0,delete this.statisticMap[o];break}SoundMgr.getInstance().playEffect(SoundMgr.EFFECT_STATISTIC),a?egret.setTimeout(this.doScoreStatistic,this,600):egret.setTimeout(this.showGameOver,this,600)},n.onScoreRoll=function(){this.score=Math.floor(this.score),this.scoreLabel.text=e.GetNumString(this.score)},n.showGameOver=function(){if(this.effectCon.removeChildren(),e.GameConst.GrayMask.visible=!0,SoundMgr.getInstance().playEffect(SoundMgr.EFFCT_HURA),void 0==e.GameConst.ReplayBtn){var t=new egret.Bitmap(RES.getRes("start_btn"));t.x=e.GameConst.StageW-t.width>>1,t.y=400,t.touchEnabled=!0,e.GameConst.ReplayBtn=t;var i=new egret.BitmapText;i.font=RES.getRes("gold_fnt_fnt"),i.textAlign="center",i.text="0",i.width=150,i.x=60,i.y=260,e.GameConst.levelLabel=i,i=new egret.BitmapText,i.font=RES.getRes("white_fnt_fnt"),i.textAlign="center",i.text="0",i.width=200,i.x=240,i.y=260,e.GameConst.scoreLabel=i;var s=new egret.TextField;s.width=250,s.textColor=16750592,s.x=115,s.y=200,s.textAlign="center",s.text="提交分数中",s.bold=!0,e.GameConst.statusTF=s}e.GameConst.Stage.addChild(e.GameConst.statusTF),this.onScoreBack(null)},n.onScoreBack=function(t){e.GameConst.Stage.addChild(e.GameConst.ReplayBtn),e.GameConst.ReplayBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.restart,this),null!=t&&1e4==t.code?(e.GameConst.statusTF.text="本局排名与得分",e.GameConst.levelLabel.text=t.data.rank+"",e.GameConst.scoreLabel.text=t.data.score+"",e.GameConst.Stage.addChild(e.GameConst.levelLabel),e.GameConst.Stage.addChild(e.GameConst.scoreLabel)):e.GameConst.statusTF.text="分数提交失败"},n.restart=function(t){this.reset(),e.GameConst.Stage.contains(e.GameConst.ReplayBtn)&&e.GameConst.Stage.removeChild(e.GameConst.ReplayBtn),e.GameConst.Stage.contains(e.GameConst.levelLabel)&&e.GameConst.Stage.removeChild(e.GameConst.levelLabel),e.GameConst.Stage.contains(e.GameConst.scoreLabel)&&e.GameConst.Stage.removeChild(e.GameConst.scoreLabel),e.GameConst.Stage.contains(e.GameConst.statusTF)&&e.GameConst.Stage.removeChild(e.GameConst.statusTF),e.GameConst.GrayMask.visible=!1,e.GameConst.ReplayBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.restart,this)},n.initGame=function(){this.scoreLabel.text=e.GetNumString(this.score),this.tree=new e.Tree,this.currentTextureName="sp.particle_1",this.psystem=new particle.GravityParticleSystem(RES.getRes(this.currentTextureName),RES.getRes("particle_json")),this.unitContainer=new egret.DisplayObjectContainer,this.unitContainer.x=this.startX,this.unitContainer.y=this.startY,this.addChild(this.unitContainer),this.effectCon=new egret.DisplayObjectContainer,this.addChild(this.effectCon),this.effectCon.x=this.startX,this.effectCon.y=this.startY,this.effectCon.touchChildren=this.effectCon.touchEnabled=!1,this.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchUnit,this);var t,i=e.GameUnit.UNIT_WIDTH;this.getInitValues();for(var s=0;s<this.col;s++)for(var n=0;n<this.row;n++)t=this.produceUnit(),t.setValue(this.initValues[s*this.col+n]),t.x=s*i,t.y=n*i,this.unitContainer.addChild(t),t.name=s+"_"+n,this.unitMap[s+"_"+n]=t},n.getInitValues=function(){this.initValues=[];for(var e,t,i=0;i<this.col;i++)for(var s=0;s<this.row;s++){for(t=[],e=this.getRandomValue(),this.result=0,this.checkValue(e,i,s);this.result>=2;){for(t.push(e),e=this.getRandomValue();-1!=t.indexOf(e);)e=this.getRandomValue();this.result=0,this.checkValue(e,i,s)}this.initValues.push(e),this.setCurMax(e)}},n.checkValue=function(e,t,i,s,n,a){void 0===s&&(s=!0),void 0===n&&(n=0),void 0===a&&(a=0);var r=t*this.col+(i-1);r>=0&&r<this.initValues.length&&this.initValues[r]==e&&(t!=n||i!=a)&&(this.result++,s&&this.checkValue(e,t,i-1,!1,t,i)),this.result>=2||(r=t*this.col+(i+1),r>=0&&r<this.initValues.length&&this.initValues[r]==e&&(t!=n||i!=a)&&(this.result++,s&&this.checkValue(e,t,i+1,!1,t,i)),this.result>=2||(r=(t-1)*this.col+i,r>=0&&r<this.initValues.length&&this.initValues[r]==e&&(t!=n||i!=a)&&(this.result++,s&&this.checkValue(e,t-1,i,!1,t,i)),this.result>=2||(r=(t+1)*this.col+i,r>=0&&r<this.initValues.length&&this.initValues[r]==e&&(t!=n||i!=a)&&(this.result++,s&&this.checkValue(e,t+1,i,!1,t,i)))))},n.getRandomValue=function(){var e=this.curSeed<5?5:this.curSeed,t=Math.random()*e+1;return Math.floor(t)},n.setCurMax=function(e){e<=this.curMax||(this.curMax=e>this.curMax?e:this.curMax,this.curSeed=this.curMax/2+1,this.levelLabel.text=this.curMax+"")},n.onTouchUnit=function(t){if(!this.inProcessing&&!this.isOver&&"game.GameUnit"==egret.getQualifiedClassName(t.target)){this.bonus=0,this.inProcessing=!0,this.selectedUnit=t.target;var i,s=this.selectedUnit.getValue();if(20>s){SoundMgr.getInstance().playEffect(SoundMgr.EFFECT_BTN),s++,this.setCurMax(s),i=e.Tree.produce(),i.data=this.selectedUnit,this.tree.reset(),this.tree.setRoot(i),this.selectedUnit.setValue(s),this.deleteArr=[],this.checkDelete(i);var n=this.deleteArr.length;n>=2?(this.score+=n+1,this.scoreLabel.text=this.score+"",this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),SoundMgr.getInstance().playEffect("1hit_mp3")):(this.inProcessing=!1,this.updateBlood(!1))}else this.doScoreStatistic()}},n.updateBlood=function(e){e?(this.blood++,this.blood=this.blood>5?5:this.blood):(this.blood--,this.blood<=0&&this.onFail()),this.updateBloodItems()},n.updateBloodItems=function(){for(var e,t=4;t>=0;t--)e=this.bloodItems[t],this.blood>t&&0==e.scaleX?egret.Tween.get(e).to({scaleX:1},100):this.blood<=t&&1==e.scaleX&&egret.Tween.get(e).to({scaleX:0},100)},n.checkDelete=function(t){var i=t.data;if(null!=i){var s,n=i.name.split("_"),a=parseInt(n[0]),r=parseInt(n[1]),h=i.getValue(),i=this.unitMap[a+1+"_"+r];null!=i&&i.getValue()==h&&-1==this.deleteArr.indexOf(i)&&i!=this.selectedUnit&&(s=e.Tree.produce(),s.data=i,this.deleteArr.push(i),t.addChild(s),this.checkDelete(s)),i=this.unitMap[a-1+"_"+r],null!=i&&i.getValue()==h&&-1==this.deleteArr.indexOf(i)&&i!=this.selectedUnit&&(s=e.Tree.produce(),s.data=i,this.deleteArr.push(i),t.addChild(s),this.checkDelete(s)),i=this.unitMap[a+"_"+(r+1)],null!=i&&i.getValue()==h&&-1==this.deleteArr.indexOf(i)&&i!=this.selectedUnit&&(s=e.Tree.produce(),s.data=i,this.deleteArr.push(i),t.addChild(s),this.checkDelete(s)),i=this.unitMap[a+"_"+(r-1)],null!=i&&i.getValue()==h&&-1==this.deleteArr.indexOf(i)&&i!=this.selectedUnit&&(s=e.Tree.produce(),s.data=i,this.deleteArr.push(i),t.addChild(s),this.checkDelete(s))}},n.updateFillMap=function(e){var t=e.split("_");if(2==t.length){var i=t[0],s=parseInt(t[1]),n=this.fillMap[i];null==n?this.fillMap[i]=[s]:n.push(s)}},n.onEnterFrame=function(e){if(this.cnt++,this.cnt==this.gap){this.cnt=0;var t=this.tree.getLeaves(),i=t.length;if(i>0)for(var s,n,a,r,h,o=0;i>o;o++)s=t[o],n=s.data,a=s.getParentNode(),r=a.data,h=egret.Tween.get(n,null,null,!0),h.to({x:r.x,y:r.y},100).call(s.removeSelf,s),a.removeChild(s),this.updateScore(10*n.getValue()),delete this.unitMap[n.name],this.updateFillMap(n.name);else{if(this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),null!=this.selectedUnit){var l=this.selectedUnit.getValue();this.updateScore(10*l),this.setCurMax(l),this.selectedUnit.setValue(l+1),this.playHideParticle(this.selectedUnit)}this.tree.reset(),egret.setTimeout(this.checkAndFill,this,200)}}},n.updateScore=function(t){this.score+=t,this.scoreLabel.text=e.GetNumString(this.score)},n.playHideParticle=function(t){var i="sp.particle_"+e.GameConst.ParticlTetureConfig[t.getValue()-2];this.psystem.stop(!0),this.currentTextureName!=i&&(this.psystem.changeTexture(RES.getRes(i)),this.currentTextureName=i),this.psystem.emitterX=t.x,this.psystem.emitterY=t.y,this.unitContainer.addChild(this.psystem),this.psystem.start(100)},n.checkAndFill=function(){var t,i,s,n,a=-1;for(n in this.fillMap){for(i=4;i>=0;i--)t=this.unitMap[n+"_"+i],null==t?a++:a>=0&&(s=egret.Tween.get(t,null,null,!0),s.to({y:t.y+e.GameUnit.UNIT_WIDTH*(a+1)},100),delete this.unitMap[t.name],t.name=n+"_"+(i+a+1),this.unitMap[t.name]=t);for(;a>=0;)t=this.produceUnit(),t.setValue(this.getRandomValue()),t.name=n+"_"+a,t.x=parseInt(n)*e.GameUnit.UNIT_WIDTH,t.y=-e.GameUnit.UNIT_WIDTH,t.alpha=1,this.unitContainer.addChildAt(t,0),this.unitMap[t.name]=t,s=egret.Tween.get(t,null,null,!0),s.to({y:t.y+e.GameUnit.UNIT_WIDTH*(a+1)},100),a--}egret.setTimeout(this.checkAllDeletable,this,600)},n.checkAllDeletable=function(){var t,i=!1,s=!1;e:for(var n=0;n<this.row;n++)for(var a=0;a<this.col;a++){t=a+"_"+n,this.tree.reset(),this.deleteArr=[],this.selectedUnit=this.unitMap[t];var r=e.Tree.produce();r.data=this.unitMap[t],this.tree.setRoot(r),this.checkDelete(r);var h=this.deleteArr.length;if(h>=2){this.score+=h+1,this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),i=!0,this.bonus++,this.updateBlood(!0);var o=this.bonus<=5?this.bonus:5;SoundMgr.getInstance().playEffect(o+1+"hit_mp3"),s=!0;break e}}if(!s&&this.bonus>=1){var l=this.bonus-1;l=l>3?3:l,e.EffectMgr.instance().playEffect(l)}this.inProcessing=i},n.start=function(){this.flag&&(this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.flag=!1)},n.pause=function(){this.hasEventListener(egret.Event.ENTER_FRAME)&&(this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.flag=!0)},n.produceUnit=function(){return this._unitCache.length>0?this._unitCache.pop():new e.GameUnit},n.reclaimUnit=function(e){-1==this._unitCache.indexOf(e)&&(this._unitCache.push(e),e.reset())},n.reset=function(){this.blood=5,this.updateBloodItems(),this.score=0,this.deleteArr=[],this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this);var t,i;for(i in this.unitMap)t=this.unitMap[i],delete this.unitMap[i],this.reclaimUnit(t),this.unitContainer.removeChild(t);this.levelLabel.text=this.curMax+"",this.scoreLabel.text=e.GetNumString(this.score);var s=e.GameUnit.UNIT_WIDTH;this.curMax=0,this.curSeed=5,this.getInitValues();for(var n=0;n<this.col;n++)for(var a=0;a<this.row;a++)t=this.produceUnit(),t.setValue(this.initValues[n*this.col+a]),t.x=n*s,t.y=a*s,this.unitContainer.addChild(t),t.name=n+"_"+a,this.unitMap[n+"_"+a]=t;this.flag=!1,this.isOver=!1},n.showGuide=function(){null==this.guide&&(this.guide=new egret.Bitmap(RES.getRes("guide1")),this.guide.x=e.GameConst.StageW-this.guide.width>>1,this.guide.y=e.GameConst.StageH-this.guide.height>>1,this.guide.touchEnabled=!1,this.guidetxt=new egret.Bitmap(RES.getRes("guide_txt")),this.guidetxt.x=e.GameConst.StageW-this.guidetxt.width>>1,this.guidetxt.y=this.guide.y+this.guide.height,e.GameConst.Stage.addChild(this.guidetxt),e.GameConst.GrayMask.visible=!0,e.GameConst.Stage.addChild(this.guide),e.GameConst.Stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGuideTouch,this),e.GameConst.Stage.addEventListener(egret.Event.ENTER_FRAME,this.playGuide,this))},n.onGuideTouch=function(t){SoundMgr.getInstance().playEffect(SoundMgr.EFFECT_BTN),e.GameConst.Stage.removeEventListener(egret.Event.ENTER_FRAME,this.playGuide,this),e.GameConst.Stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGuideTouch,this),e.GameConst.Stage.removeChild(this.guide),e.GameConst.Stage.removeChild(this.guidetxt),e.GameConst.GrayMask.visible=!1,this.guide=null,this.guidetxt=null,this.gap=6,RES.destroyRes("guide_json")},n.playGuide=function(e){this.gap++,this.gap>=4&&(this.currentFrame++,this.currentFrame<=14&&(this.guide.texture=RES.getRes("guide"+this.currentFrame)),this.currentFrame>=20&&(this.currentFrame=0),this.gap=0)},i.instance=function(){return null==i._instance&&(i._instance=new e.GameMain),i._instance},i}(egret.DisplayObjectContainer);e.GameMain=t,egret.registerClass(t,"game.GameMain")}(game||(game={}));var game;!function(e){var t=function(t){function i(){t.call(this),this.init(),this.touchEnabled=!0}__extends(i,t);var s=(__define,i),n=s.prototype;return n.init=function(){this.shape=new egret.Bitmap,this.addChild(this.shape)},n.drawShape=function(){var e=RES.getRes("sp.unit_"+this.value);this.shape.texture=e,this.shape.cacheAsBitmap=!0,this.shape.x=-this.shape.width>>1,this.shape.y=-this.shape.height>>1},n.setValue=function(e){this.value!=e&&(this.value=Math.floor(e),this.drawShape())},n.getValue=function(){return this.value},n.removeSelf=function(){null!=this.parent&&this.parent.removeChild(this),e.GameMain.instance().reclaimUnit(this)},n.reset=function(){this.name=""},i.UNIT_WIDTH=84,i}(egret.DisplayObjectContainer);e.GameUnit=t,egret.registerClass(t,"game.GameUnit")}(game||(game={}));var game;!function(e){function t(e){var t=new egret.Bitmap(RES.getRes(e));return t.touchEnabled=!1,t.cacheAsBitmap=!0,t}function i(e,t){if(void 0===t&&(t=!1),!t||1e3>e)return e.toString();for(var i=e.toString(),s="",n=i.length,a=0;n>0;)2!=a||1==n?s=i.charAt(n-1)+s:(s="."+i.charAt(n-1)+s,a=-1),a++,n--;return s}function s(e){for(;0!=e.numChildren;){var t=e.removeChildAt(0);t=null}}e.GetBitmap=t,e.GetNumString=i,e.RemoveAllChild=s}(game||(game={}));var game;!function(e){var t=function(){function e(){}var t=(__define,e);t.prototype;return e.myDiamonds=1e3,e.myStars=1234,e.VERSION="r20161204-01",e}();e.Model=t,egret.registerClass(t,"game.Model")}(game||(game={}));var game;!function(e){var t=function(t){function i(){t.call(this),this._children=[]}__extends(i,t);var s=(__define,i),n=s.prototype;return n.addChild=function(e){-1==this._children.indexOf(e)&&(this._children.push(e),e.setParentNode(this))},n.removeChild=function(e){var t=this._children.indexOf(e);-1!=t&&(this._children.splice(t,1),e.setParentNode(null))},n.children=function(){return this._children},n.isRoot=function(){return null==this._parentNode},n.getParentNode=function(){return this._parentNode},n.setParentNode=function(e){this._parentNode=e},n.isChildRoot=function(){return this._children.length>1},n.isLeaf=function(){return 0==this._children.length&&null!=this._parentNode},n.resetChildren=function(){for(var t;0!=this._children.length;)t=this._children.pop(),t.resetChildren(),t.reset();e.Tree.reclaimNode(this)},n.removeSelf=function(){null!=this._parentNode&&this._parentNode.removeChild(this),this.data&&null!=this.data.parent&&(this.data.parent.removeChild(this.data),e.GameMain.instance().reclaimUnit(this.data)),e.Tree.reclaimNode(this)},n.reset=function(){this._parentNode=null,this._children=[],this.data=null},i}(egret.HashObject);e.Node=t,egret.registerClass(t,"game.Node")}(game||(game={}));var game;!function(e){var t=function(t){function i(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.addEvents,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeEvents,this)}__extends(i,t);var s=(__define,i),n=s.prototype;return n.addEvents=function(){this.startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStart,this),this.btn_home.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onHome,this),this.btn_refresh.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRefresh,this)},n.removeEvents=function(){this.startBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onStart,this),this.btn_home.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onHome,this),this.btn_refresh.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRefresh,this)},n.onStart=function(t){SoundMgr.getInstance().playEffect(SoundMgr.EFFECT_BTN),e.GameConst.GrayMask.visible=!1,e.GameMain.instance().start(),e.ShakeMgr.instance().resume()},n.onHome=function(t){SoundMgr.getInstance().playEffect(SoundMgr.EFFECT_BTN),e.GameConst.GrayMask.visible=!1,e.GameMain.instance().reset(),e.ShakeMgr.instance().reset()},n.onRefresh=function(t){SoundMgr.getInstance().playEffect(SoundMgr.EFFECT_BTN),e.GameConst.GrayMask.visible=!1,e.GameMain.instance().reset(),e.ShakeMgr.instance().reset()},i.instance=function(){return null==i._instance&&(i._instance=new e.PausePanel),i._instance},i}(egret.DisplayObjectContainer);e.PausePanel=t,egret.registerClass(t,"game.PausePanel")}(game||(game={}));var game;!function(e){var t=function(e){function t(){e.call(this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.parse=function(e){this.index=e.id,this.fx=e.fx,this.fy=e.fy,this.tx=e.tx,this.ty=e.ty,this.fa=e.fa,this.ta=e.ta,this.fscl=e.fscl,this.tscl=e.tscl,this.frameCnt=e.frames},s.initDis=function(e){e.x=this.fx,e.y=this.fy,e.alpha=this.fa,e.scaleX=e.scaleY=this.fscl},s.getTweenProps=function(){var e={};return this.fx!=this.tx&&(e.x=this.tx),this.fy!=this.ty&&(e.y=this.ty),this.fa!=this.ta&&(e.alpha=this.ta),this.fscl!=this.tscl&&(e.scaleX=e.scaleY=this.tscl),e},t}(egret.HashObject);e.PhaseVo=t,egret.registerClass(t,"game.PhaseVo")}(game||(game={}));var RankItem=function(e){function t(){e.call(this),this.rankLabel=new egret.BitmapText,this.rankLabel.font=RES.getRes("gold_fnt_fnt"),this.rankLabel.textAlign="center",this.rankLabel.text="0",this.rankLabel.width=150,this.rankLabel.height=38,this.rankLabel.x=5,this.rankLabel.y=2,this.addChild(this.rankLabel),this.rankScore=new egret.BitmapText,this.rankScore.font=RES.getRes("white_fnt_fnt"),this.rankScore.textAlign="center",this.rankScore.text="0",this.rankScore.width=200,this.rankScore.height=38,this.rankScore.x=160,this.rankScore.y=2,this.height=38,this.addChild(this.rankScore)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.dataChanged=function(){e.prototype.dataChanged.call(this),this.rankLabel.text=this.data.rank,this.rankScore.text=this.data.score},t}(eui.ItemRenderer);egret.registerClass(RankItem,"RankItem");var game;!function(e){var t=function(t){function i(){t.call(this)}__extends(i,t);var s=(__define,i),n=s.prototype;return n.onOk=function(t){SoundMgr.getInstance().playEffect(SoundMgr.EFFECT_BTN),e.GameConst.GrayMask.visible=!1,null!=this.okCallBack&&(this.okCallBack.call(this),this.okCallBack=null)},n.onCancel=function(t){SoundMgr.getInstance().playEffect(SoundMgr.EFFECT_BTN),e.GameConst.GrayMask.visible=!1,this.curData=null,null!=this.cancelCallBack&&(this.cancelCallBack.call(this),this.cancelCallBack=null)},n.showContent=function(t,i){e.GameConst.GrayMask.visible=!0,this.curData=t},i.instance=function(){return null==i._instance&&(i._instance=new e.RemindPanel),i._instance},i}(egret.DisplayObjectContainer);e.RemindPanel=t,egret.registerClass(t,"game.RemindPanel")}(game||(game={}));var game;!function(e){var t=function(t){function i(){t.call(this),this.flag=!1,this.gap=3,this.shakeItems={}}__extends(i,t);var s=(__define,i),n=s.prototype;return n.addShakeItem=function(t,i){if(null!=this.shakeItems[t]){this.shakeItems[t];this.removeShakeItem(t)}i.gap=0!=i.gap?i.gap:5,i.cnt=0!=i.cnt?i.cnt:5,this.shakeItems[t]=i,this.flag||(e.GameConst.Stage.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.flag=!0)},n.onEnterFrame=function(t){this.gap--;var i=!1;if(-1==this.gap){var s,n,a;for(var r in this.shakeItems)s=this.shakeItems[r],n=s.dis,a=s.type,"shakeh"==a?0==s.cnt?(this.removeShakeItem(r),n.x=s.ox):(s.cnt--,s.cnt%2==0?n.x=s.ox+s.gap:n.x=s.ox-s.gap):"shakev"==a?0==s.cnt?(this.removeShakeItem(r),n.y=s.oy):(s.cnt--,s.cnt%2==0?n.y=s.oy+s.gap:n.y=s.oy-s.gap):"twist"==a&&(0==s.cnt?(this.removeShakeItem(r),n.rotation=0):(s.cnt--,s.cnt%2==0?n.rotation=s.gap:n.rotation=-s.gap)),i=!0;this.gap=3,i||(e.GameConst.Stage.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.flag=!1)}},n.removeShakeItem=function(e){if(null!=this.shakeItems[e]){var t=this.shakeItems[e].dis;"shakeh"==this.shakeItems[e].type?t.x=this.shakeItems[e].ox:"shakev"==this.shakeItems[e].type?t.y=this.shakeItems[e].oy:"twist"==this.shakeItems[e].type&&(t.rotation=0),delete this.shakeItems[e]}},n.pause=function(){this.flag&&e.GameConst.Stage.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)},n.resume=function(){this.flag&&e.GameConst.Stage.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)},n.reset=function(){for(var t in this.shakeItems)this.removeShakeItem(t);this.flag=!1,e.GameConst.Stage.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)},i.instance=function(){return null==i._instance&&(i._instance=new e.ShakeMgr),i._instance},i}(egret.HashObject);e.ShakeMgr=t,egret.registerClass(t,"game.ShakeMgr")}(game||(game={}));var game;!function(e){var t=function(e){function t(){e.call(this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.removeSelf=function(){null!=this.parent&&this.parent.removeChild(this),this.numChildren&&this.removeChildren(),egret.Tween.removeTweens(this)},t}(egret.DisplayObjectContainer);e.SomeContainer=t,egret.registerClass(t,"game.SomeContainer")}(game||(game={}));var SoundMgr=function(e){function t(){e.call(this),this.isSoundLoaded=!1}__extends(t,e);var i=(__define,t),s=i.prototype;return s.playBg=function(){null!=this.bgChannel&&this.bgChannel.stop();var e=RES.getRes(t.BG);this.bgChannel=e.play()},s.playEffect=function(e,t){void 0===t&&(t="");var i=RES.getRes(e);null!=i&&i.play(0,1)},t.getInstance=function(){return null==t._instance&&(t._instance=new t),t._instance},t.BG="bg_mp3",t.EFFECT_BTN="btn_wav",t.CHOSE="chosepet_wav",t.EFFECT_STATISTIC="statistic_mp3",t.EFFCT_HURA="hura_wav",t}(egret.EventDispatcher);egret.registerClass(SoundMgr,"SoundMgr");var game;!function(e){var t=function(t){function i(){t.call(this),this.listExml='<e:Scroller xmlns:e="http://ns.egret.com/eui">\n                <e:List id="list" width="400" height="190">\n                </e:List>\n            </e:Scroller>',this.title=new egret.Bitmap(RES.getRes("title_png")),this.title.x=e.GameConst.StageW-this.title.width>>1,this.title.y=150,this.addChild(this.title),this.startBtn=new egret.Bitmap(RES.getRes("start_btn")),this.startBtn.x=e.GameConst.StageW-this.startBtn.width>>1,this.startBtn.y=250,this.startBtn.touchEnabled=!0,this.addChild(this.startBtn),this.startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startGame,this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.addEvents,this)}__extends(i,t);var s=(__define,i),n=s.prototype;return n.addEvents=function(t){if(null==this.rankList){var i=new egret.Bitmap(RES.getRes("img_rank_bg_png"));i.x=e.GameConst.StageW-i.width>>1,i.y=460,this.addChild(i);var s=EXML.parse(this.listExml),n=new s;this.addChild(n),this.rankList=n.list,this.rankList.itemRenderer=RankItem,n.x=45,n.y=535,this.rankList.useVirtualLayout=!0,this.addChild(n)}},n.startGame=function(t){t.stopImmediatePropagation(),SoundMgr.getInstance().playEffect(SoundMgr.EFFECT_BTN),this.parent.addChild(e.GameMain.instance()),this.parent.removeChild(this)},n.onRankData=function(e){if(1e4==e.code){var t=e.data;this.rankList.dataProvider=new eui.ArrayCollection(t)}else egret.log("rank fail")},i.instance=function(){return null==i._instance&&(i._instance=new e.StartScene),i._instance},i}(egret.DisplayObjectContainer);e.StartScene=t,egret.registerClass(t,"game.StartScene")}(game||(game={}));var game;!function(e){var t=function(t){function i(){t.call(this)}__extends(i,t);var s=(__define,i),n=s.prototype;return n.getRoot=function(){return this._root},n.setRoot=function(e){this._root=e},n.getLeaves=function(){var e=[];return this.getNodeLeaf(this._root,e),e},n.getNodeLeaf=function(e,t){if(e.isLeaf())t.push(e);else for(var e,i=e.children(),s=i.length,n=0;s>n;n++)e=i[n],e.isLeaf()?t.push(e):this.getNodeLeaf(e,t)},n.reset=function(){null!=this._root&&this._root.reset(),this._root=null},i.reclaimNode=function(e){e.reset(),-1==i._nodeCache.indexOf(e)&&i._nodeCache.push(e)},i.produce=function(){return 0!=i._nodeCache.length?i._nodeCache.pop():new e.Node},i._nodeCache=[],i}(egret.HashObject);e.Tree=t,egret.registerClass(t,"game.Tree")}(game||(game={}));var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t),s=i.prototype;return s.createView=function(){this.icon=new egret.Bitmap(RES.getRes("loading_logo_png")),this.icon.x=game.GameConst.StageW-this.icon.width>>1,this.icon.y=100,this.addChild(this.icon),this.textField=new egret.TextField,this.addChild(this.textField),this.textField.textColor=2171169,this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},s.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.onAddToStage=function(e){game.GameConst.StageH=this.stage.stageHeight,game.GameConst.StageW=this.stage.stageWidth,this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/resource.json","resource/")
},s.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup("preload")},s.onResourceLoadComplete=function(e){"preload"==e.groupName?(this.bg=new egret.Bitmap(RES.getRes("bg")),this.addChild(this.bg),RES.loadGroup("next")):"next"==e.groupName?(this.stage.removeChild(this.loadingView),this.createScene(),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this)):"sounds"==e.groupName&&(SoundMgr.getInstance().isSoundLoaded=!0,SoundMgr.getInstance().playBg())},s.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},s.onResourceProgress=function(e){"preload"==e.groupName?this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal):"next"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},s.createScene=function(){game.GameConst.Stage=this.stage;var e=new egret.DisplayObjectContainer;this.addChild(game.StartScene.instance()),this.stage.addChild(e),game.EffectMgr.instance().setEffectContainer(e);var t=new egret.Shape;t.graphics.beginFill(0,.8),t.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),t.graphics.endFill(),this.stage.addChild(t),t.visible=!1,t.touchEnabled=!0,game.GameConst.GrayMask=t,RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.loadGroup("sounds")},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");