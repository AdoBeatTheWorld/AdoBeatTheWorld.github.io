function GetBitmap(t){var e=new egret.Bitmap(RES.getRes(t));return e.touchEnabled=!1,e.cacheAsBitmap=!0,e}function GetNumString(t,e){if(void 0===e&&(e=!1),!e||1e3>t)return t.toString();for(var i=t.toString(),n="",s=i.length,a=0;s>0;)2!=a||1==s?n=i.charAt(s-1)+n:(n="."+i.charAt(s-1)+n,a=-1),a++,s--;return n}function RemoveAllChild(t){for(;0!=t.numChildren;){var e=t.removeChildAt(0);e=null}}var DukeNode=function(t){function e(){t.call(this),this._children=[]}__extends(e,t);var i=(__define,e),n=i.prototype;return n.addChild=function(t){-1==this._children.indexOf(t)&&(this._children.push(t),t.setParentNode(this))},n.removeChild=function(t){var e=this._children.indexOf(t);-1!=e&&(this._children.splice(e,1),t.setParentNode(null))},n.children=function(){return this._children},n.isRoot=function(){return null==this._parentNode},n.getParentNode=function(){return this._parentNode},n.setParentNode=function(t){this._parentNode=t},n.isChildRoot=function(){return this._children.length>1},n.isLeaf=function(){return 0==this._children.length&&null!=this._parentNode},n.resetChildren=function(){for(var t;0!=this._children.length;)t=this._children.pop(),t.resetChildren(),t.reset();DukeTree.reclaimNode(this)},n.removeSelf=function(){null!=this._parentNode&&this._parentNode.removeChild(this),this.data&&null!=this.data.parent&&(this.data.parent.removeChild(this.data),GameMain.instance().reclaimUnit(this.data)),DukeTree.reclaimNode(this)},n.reset=function(){this._parentNode=null,this._children=[],this.data=null},e}(egret.HashObject);egret.registerClass(DukeNode,"DukeNode");var DukeTree=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.getRoot=function(){return this._root},n.setRoot=function(t){this._root=t},n.getLeaves=function(){var t=[];return this.getDukeNodeLeaf(this._root,t),t},n.getDukeNodeLeaf=function(t,e){if(t.isLeaf())e.push(t);else for(var t,i=t.children(),n=i.length,s=0;n>s;s++)t=i[s],t.isLeaf()?e.push(t):this.getDukeNodeLeaf(t,e)},n.reset=function(){null!=this._root&&this._root.reset(),this._root=null},e.reclaimNode=function(t){t.reset(),-1==e._DukeNodeCache.indexOf(t)&&e._DukeNodeCache.push(t)},e.produce=function(){return 0!=e._DukeNodeCache.length?e._DukeNodeCache.pop():new DukeNode},e._DukeNodeCache=[],e}(egret.HashObject);egret.registerClass(DukeTree,"DukeTree");var EventController=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e);i.prototype;return e.getInstance=function(){return null==e._instance&&(e._instance=new e),e._instance},e.LOW_FRAMERATE="low_framerate",e.BLOOD_CHANGED="blood_changed",e.ITEM_CHANGED="item_changed",e.CANCEL_ITEM_SELECT="cancel_item_select",e.ITEM_USE="item_use",e.FAIL="fail",e}(egret.EventDispatcher);egret.registerClass(EventController,"EventController");var GameConst=function(){function t(){}var e=(__define,t);e.prototype;return t.ParticlTetureConfig=[1,2,3,4,5,6,2,8,5,3,1,2,3,4,5,6,2,8,5,3],t.lowModel=!1,t}();egret.registerClass(GameConst,"GameConst");var GameMain=function(t){function e(){t.call(this),this.row=7,this.col=7,this.startX=40,this.startY=300,this.unitMap={},this.score=0,this.result=0,this.curMax=0,this.curSeed=8,this.deleteArr=[],this.blood=5,this.gap=6,this.cnt=0,this.fillMap={},this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddedToStage,this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onAddedToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddedToStage,this),EventController.getInstance().addEventListener(EventController.FAIL,this.onFail,this),null==this._unitCache&&(this._unitCache=[],this.StageH=this.stage.stageHeight,this.StageW=this.stage.stageWidth,this.scoreTf=new egret.TextField,this.scoreTf.text="得分：0",this.scoreTf.fontFamily="微软雅黑",this.scoreTf.x=10,this.scoreTf.y=20,this.scoreTf.touchEnabled=!1,this.addChild(this.scoreTf),this.maxNumTf=new egret.TextField,this.maxNumTf.text="最大：0",this.maxNumTf.fontFamily="微软雅黑",this.maxNumTf.x=10,this.maxNumTf.y=70,this.maxNumTf.touchEnabled=!1,this.addChild(this.maxNumTf),this.bloodTf=new egret.TextField,this.bloodTf.text="机会：5",this.bloodTf.fontFamily="微软雅黑",this.bloodTf.x=10,this.bloodTf.y=120,this.bloodTf.touchEnabled=!1,this.addChild(this.bloodTf),this.initGame())},n.onFail=function(t){this.statisticMap={};var e,i,n;for(i in this.unitMap)n=this.unitMap[i],e=n.getValue(),null==this.statisticMap[e]&&(this.statisticMap[e]=[]),this.statisticMap[e].push(i);this.doScoreStatistic()},n.doScoreStatistic=function(){var t,e,i,n,s,a,r,h,o=GameUnit.UNIT_WIDTH;this.isOver=!0;var l;for(l in this.statisticMap){i=this.statisticMap[l],e=i.length;for(var c=0;e>c;c++)a=10*parseInt(l),h=this.unitMap[i[c]],n=i[c].split("_"),t=new SomeContainer,this.score+=a,this.scoreTf.text="得分："+this.score,t.x=(parseInt(n[0])-.3)*o,t.y=parseInt(n[1])*o,t.alpha=0,s=egret.Tween.get(t,null,null,!0),this.effectCon.addChild(t),s.to({y:t.y-80,alpha:1},500).call(t.removeSelf,t),ShakeMgr.instance().addShakeItem(h.name,{gap:5,cnt:5,dis:h,ox:parseInt(n[0])*o,type:"shakeh"});r=!0,delete this.statisticMap[l];break}r?egret.setTimeout(this.doScoreStatistic,this,600):egret.setTimeout(this.showGameOver,this,600)},n.showGameOver=function(){this.effectCon.removeChildren(),GameConst.GrayMask.visible=!0},n.initGame=function(){this.tree=new DukeTree,this.unitContainer=new egret.DisplayObjectContainer,this.unitContainer.x=this.startX,this.unitContainer.y=this.startY,this.addChild(this.unitContainer),this.effectCon=new egret.DisplayObjectContainer,this.addChild(this.effectCon),this.effectCon.x=this.startX,this.effectCon.y=this.startY,this.effectCon.touchChildren=this.effectCon.touchEnabled=!1,this.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchUnit,this);var t,e=GameUnit.UNIT_WIDTH;this.getInitValues();for(var i=0;i<this.col;i++)for(var n=0;n<this.row;n++)t=this.produceUnit(),t.setValue(this.initValues[i*this.col+n]),t.x=i*e,t.y=n*e,this.unitContainer.addChild(t),t.name=i+"_"+n,this.unitMap[i+"_"+n]=t},n.getInitValues=function(){this.initValues=[];for(var t,e,i=0;i<this.col;i++)for(var n=0;n<this.row;n++){for(e=[],t=this.getRandomValue(),this.result=0,this.checkValue(t,i,n);this.result>=2;){for(e.push(t),t=this.getRandomValue();-1!=e.indexOf(t);)t=this.getRandomValue();this.result=0,this.checkValue(t,i,n)}this.initValues.push(t)}this.maxNumTf.text="最大："+this.curMax},n.checkValue=function(t,e,i,n,s,a){void 0===n&&(n=!0),void 0===s&&(s=0),void 0===a&&(a=0);var r=e*this.col+(i-1);r>=0&&r<this.initValues.length&&this.initValues[r]==t&&(e!=s||i!=a)&&(this.result++,n&&this.checkValue(t,e,i-1,!1,e,i)),this.result>=2||(r=e*this.col+(i+1),r>=0&&r<this.initValues.length&&this.initValues[r]==t&&(e!=s||i!=a)&&(this.result++,n&&this.checkValue(t,e,i+1,!1,e,i)),this.result>=2||(r=(e-1)*this.col+i,r>=0&&r<this.initValues.length&&this.initValues[r]==t&&(e!=s||i!=a)&&(this.result++,n&&this.checkValue(t,e-1,i,!1,e,i)),this.result>=2||(r=(e+1)*this.col+i,r>=0&&r<this.initValues.length&&this.initValues[r]==t&&(e!=s||i!=a)&&(this.result++,n&&this.checkValue(t,e+1,i,!1,e,i)))))},n.getRandomValue=function(){var t=this.curSeed<8?8:this.curSeed,e=Math.ceil(Math.random()*t);return this.curMax=this.curMax>e?this.curMax:e,e},n.setCurMax=function(t){t<=this.curMax||(this.curMax=t>this.curMax?t:this.curMax,this.curSeed=this.curMax/2+1,this.maxNumTf.text="最大："+this.curMax)},n.onTouchUnit=function(t){if(!this.inProcessing&&!this.isOver&&t.target instanceof GameUnit){this.bonus=0,this.inProcessing=!0,this.selectedUnit=t.target;var e,i=this.selectedUnit.getValue();i++,this.setCurMax(i),this.curMax=this.curMax>i?this.curMax:i,e=DukeTree.produce(),e.data=this.selectedUnit,this.tree.reset(),this.tree.setRoot(e),this.selectedUnit.setValue(i),this.deleteArr=[],this.checkDelete(e);var n=this.deleteArr.length;n>=2?(this.score+=n+1,this.scoreTf.text="得分："+this.score,this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),SoundMgr.getInstance().playEffect("1hit_wav")):(this.inProcessing=!1,this.blood--,this.blood<=0&&this.doScoreStatistic())}},n.checkDelete=function(t){var e=t.data;if(null!=e){var i,n=e.name.split("_"),s=parseInt(n[0]),a=parseInt(n[1]),r=e.getValue(),e=this.unitMap[s+1+"_"+a];null!=e&&e.getValue()==r&&-1==this.deleteArr.indexOf(e)&&e!=this.selectedUnit&&(i=DukeTree.produce(),i.data=e,this.deleteArr.push(e),t.addChild(i),this.checkDelete(i)),e=this.unitMap[s-1+"_"+a],null!=e&&e.getValue()==r&&-1==this.deleteArr.indexOf(e)&&e!=this.selectedUnit&&(i=DukeTree.produce(),i.data=e,this.deleteArr.push(e),t.addChild(i),this.checkDelete(i)),e=this.unitMap[s+"_"+(a+1)],null!=e&&e.getValue()==r&&-1==this.deleteArr.indexOf(e)&&e!=this.selectedUnit&&(i=DukeTree.produce(),i.data=e,this.deleteArr.push(e),t.addChild(i),this.checkDelete(i)),e=this.unitMap[s+"_"+(a-1)],null!=e&&e.getValue()==r&&-1==this.deleteArr.indexOf(e)&&e!=this.selectedUnit&&(i=DukeTree.produce(),i.data=e,this.deleteArr.push(e),t.addChild(i),this.checkDelete(i))}},n.updateFillMap=function(t){var e=t.split("_");if(2==e.length){var i=e[0],n=parseInt(e[1]),s=this.fillMap[i];null==s?this.fillMap[i]=[n]:s.push(n)}},n.onEnterFrame=function(t){if(this.cnt++,this.cnt==this.gap){this.cnt=0;var e=this.tree.getLeaves(),i=e.length;if(i>0)for(var n,s,a,r,h,o=0;i>o;o++)n=e[o],s=n.data,a=n.getParentNode(),r=a.data,h=egret.Tween.get(s,null,null,!0),h.to({x:r.x,y:r.y},100).call(n.removeSelf,n),a.removeChild(n),this.updateScore(10*s.getValue()),delete this.unitMap[s.name],this.updateFillMap(s.name);else{if(this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),null!=this.selectedUnit){var l=this.selectedUnit.getValue();this.updateScore(10*l),this.selectedUnit.setValue(l+1),this.playHideParticle(this.selectedUnit)}this.tree.reset(),egret.setTimeout(this.checkAndFill,this,200)}}},n.updateScore=function(t){this.score+=t,this.scoreTf.text="得分："+this.score},n.playHideParticle=function(t){},n.checkAndFill=function(){var t,e,i,n,s=-1;for(n in this.fillMap){for(e=this.row-1;e>=0;e--)t=this.unitMap[n+"_"+e],null==t?s++:s>=0&&(i=egret.Tween.get(t,null,null,!0),i.to({y:t.y+GameUnit.UNIT_WIDTH*(s+1)},100),delete this.unitMap[t.name],t.name=n+"_"+(e+s+1),this.unitMap[t.name]=t);for(;s>=0;)t=this.produceUnit(),t.setValue(this.getRandomValue()),t.name=n+"_"+s,t.x=parseInt(n)*GameUnit.UNIT_WIDTH,t.y=-GameUnit.UNIT_WIDTH,t.alpha=1,this.unitContainer.addChildAt(t,0),this.unitMap[t.name]=t,i=egret.Tween.get(t,null,null,!0),i.to({y:t.y+GameUnit.UNIT_WIDTH*(s+1)},100),s--;this.maxNumTf.text="最大："+this.curMax}egret.setTimeout(this.checkAllDeletable,this,600)},n.checkAllDeletable=function(){var t,e=!1,i=!1;t:for(var n=0;n<this.row;n++)for(var s=0;s<this.col;s++){t=s+"_"+n,this.tree.reset(),this.deleteArr=[],this.selectedUnit=this.unitMap[t];var a=DukeTree.produce();a.data=this.unitMap[t],this.tree.setRoot(a),this.checkDelete(a);var r=this.deleteArr.length;if(r>=2){this.score+=r+1,this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),e=!0,this.bonus++;var h=this.bonus<=5?this.bonus:5;SoundMgr.getInstance().playEffect(h+1+"hit_wav"),i=!0;break t}}i||(this.scoreTf.text="得分："+this.score,this.blood+=this.bonus,this.blood=Math.min(5,this.blood),this.bloodTf.text="血量："+this.blood),this.inProcessing=e},n.start=function(){this.flag&&(this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.flag=!1)},n.pause=function(){this.hasEventListener(egret.Event.ENTER_FRAME)&&(this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.flag=!0)},n.produceUnit=function(){return this._unitCache.length>0?this._unitCache.pop():new GameUnit},n.reclaimUnit=function(t){-1==this._unitCache.indexOf(t)&&(this._unitCache.push(t),t.reset())},n.reset=function(){this.deleteArr=[],this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this);var t,e;for(e in this.unitMap)t=this.unitMap[e],delete this.unitMap[e],this.reclaimUnit(t),this.unitContainer.removeChild(t);var i=GameUnit.UNIT_WIDTH;this.curMax=0,this.curSeed=5,this.blood=5,this.getInitValues();for(var n=0;n<this.col;n++)for(var s=0;s<this.row;s++)t=this.produceUnit(),t.setValue(this.initValues[n*this.col+s]),t.x=n*i,t.y=s*i,this.unitContainer.addChild(t),t.name=n+"_"+s,this.unitMap[n+"_"+s]=t;this.flag=!1,this.isOver=!1},e.instance=function(){return null==e._instance&&(e._instance=new e),e._instance},e}(egret.DisplayObjectContainer);egret.registerClass(GameMain,"GameMain");var GameUnit=function(t){function e(){t.call(this),this.value=0,this.init(),this.touchEnabled=!0}__extends(e,t);var i=(__define,e),n=i.prototype;return n.init=function(){this.bottom=new egret.Bitmap(RES.getRes("botton_png")),this.bottom.x=-this.bottom.texture.textureWidth>>1,this.bottom.y=-this.bottom.texture.textureHeight>>1,this.addChild(this.bottom),this.numTxt=new egret.TextField,this.numTxt.touchEnabled=!1,this.numTxt.fontFamily="Arial",this.numTxt.textColor=0,this.addChild(this.numTxt)},n.setValue=function(t){this.value!=t&&(this.value=Math.floor(t),this.numTxt.text=this.value+"",this.numTxt.x=-this.numTxt.textWidth>>1,this.numTxt.y=-this.numTxt.textHeight>>1)},n.getValue=function(){return this.value},n.removeSelf=function(){null!=this.parent&&this.parent.removeChild(this),GameMain.instance().reclaimUnit(this)},n.reset=function(){this.name=""},e.UNIT_WIDTH=64,e}(egret.DisplayObjectContainer);egret.registerClass(GameUnit,"GameUnit");var Model=function(){function t(){}var e=(__define,t);e.prototype;return t}();egret.registerClass(Model,"Model");var PausePanel=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.addEvents,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeEvents,this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.addEvents=function(){this.startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStart,this),this.btn_home.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onHome,this),this.btn_refresh.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRefresh,this)},n.removeEvents=function(){this.startBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onStart,this),this.btn_home.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onHome,this),this.btn_refresh.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRefresh,this)},n.onStart=function(t){SoundMgr.getInstance().playEffect(SoundMgr.EFFECT_BTN),GameConst.GrayMask.visible=!1,GameMain.instance().start(),ShakeMgr.instance().resume()},n.onHome=function(t){SoundMgr.getInstance().playEffect(SoundMgr.EFFECT_BTN),GameConst.GrayMask.visible=!1,GameMain.instance().reset(),ShakeMgr.instance().reset()},n.onRefresh=function(t){SoundMgr.getInstance().playEffect(SoundMgr.EFFECT_BTN),GameConst.GrayMask.visible=!1,GameMain.instance().reset(),ShakeMgr.instance().reset()},e.instance=function(){return null==e._instance&&(e._instance=new e),e._instance},e}(egret.DisplayObjectContainer);egret.registerClass(PausePanel,"PausePanel");var RankPanel=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.addEvents,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeEvents,this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.addEvents=function(t){},n.removeEvents=function(t){},n.onStart=function(t){SoundMgr.getInstance().playEffect(SoundMgr.EFFECT_BTN)},e.getInstance=function(){return null==e._instance&&(e._instance=new e),e._instance},e}(egret.DisplayObjectContainer);egret.registerClass(RankPanel,"RankPanel");var RemindPanel=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onOk=function(t){SoundMgr.getInstance().playEffect(SoundMgr.EFFECT_BTN),GameConst.GrayMask.visible=!1,null!=this.okCallBack&&(this.okCallBack.call(this),this.okCallBack=null)},n.onCancel=function(t){SoundMgr.getInstance().playEffect(SoundMgr.EFFECT_BTN),GameConst.GrayMask.visible=!1,this.curData=null,null!=this.cancelCallBack&&(this.cancelCallBack.call(this),this.cancelCallBack=null)},n.showContent=function(t,e){GameConst.GrayMask.visible=!0,this.curData=t},e.instance=function(){return null==e._instance&&(e._instance=new e),e._instance},e}(egret.DisplayObjectContainer);egret.registerClass(RemindPanel,"RemindPanel");var ShakeMgr=function(t){function e(){t.call(this),this.flag=!1,this.gap=3,this.shakeItems={}}__extends(e,t);var i=(__define,e),n=i.prototype;return n.addShakeItem=function(t,e){if(null!=this.shakeItems[t]){this.shakeItems[t];this.removeShakeItem(t)}e.gap=0!=e.gap?e.gap:5,e.cnt=0!=e.cnt?e.cnt:5,this.shakeItems[t]=e,this.flag||(GameConst.Stage.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.flag=!0)},n.onEnterFrame=function(t){this.gap--;var e=!1;if(-1==this.gap){var i,n,s;for(var a in this.shakeItems)i=this.shakeItems[a],n=i.dis,s=i.type,"shakeh"==s?0==i.cnt?(this.removeShakeItem(a),n.x=i.ox):(i.cnt--,i.cnt%2==0?n.x=i.ox+i.gap:n.x=i.ox-i.gap):"shakev"==s?0==i.cnt?(this.removeShakeItem(a),n.y=i.oy):(i.cnt--,i.cnt%2==0?n.y=i.oy+i.gap:n.y=i.oy-i.gap):"twist"==s&&(0==i.cnt?(this.removeShakeItem(a),n.rotation=0):(i.cnt--,i.cnt%2==0?n.rotation=i.gap:n.rotation=-i.gap)),e=!0;this.gap=3,e||(GameConst.Stage.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.flag=!1)}},n.removeShakeItem=function(t){if(null!=this.shakeItems[t]){var e=this.shakeItems[t].dis;"shakeh"==this.shakeItems[t].type?e.x=this.shakeItems[t].ox:"shakev"==this.shakeItems[t].type?e.y=this.shakeItems[t].oy:"twist"==this.shakeItems[t].type&&(e.rotation=0),delete this.shakeItems[t]}},n.pause=function(){this.flag&&GameConst.Stage.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)},n.resume=function(){this.flag&&GameConst.Stage.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)},n.reset=function(){for(var t in this.shakeItems)this.removeShakeItem(t);this.flag=!1,GameConst.Stage.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)},e.instance=function(){return null==e._instance&&(e._instance=new e),e._instance},e}(egret.HashObject);egret.registerClass(ShakeMgr,"ShakeMgr");var SomeContainer=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.removeSelf=function(){null!=this.parent&&this.parent.removeChild(this),this.numChildren&&this.removeChildren(),egret.Tween.removeTweens(this)},e}(egret.DisplayObjectContainer);egret.registerClass(SomeContainer,"SomeContainer");var SoundMgr=function(t){function e(){t.call(this),this.isSoundLoaded=!1,this.channelMap={},this.playingEffect={}}__extends(e,t);var i=(__define,e),n=i.prototype;return n.playBg=function(t){return void(void 0===t&&(t=null))},n.playEffect=function(t,e){return void(void 0===e&&(e=""))},n.effectComplete=function(t){var e=t.target;e.removeEventListener(egret.Event.SOUND_COMPLETE,this.effectComplete,this);var i=this.channelMap[e.hashCode];delete this.playingEffect[i]},n.checkUnfinishedEffects=function(){var t,e=egret.getTimer();for(var i in this.playingEffect)t=this.playingEffect[i],e-t>5e3&&delete this.playEffect(i)},e.getInstance=function(){return null==e._instance&&(e._instance=new e),e._instance},e.BG="bgmsc_mp3",e.TOUCHMOVE="touchmove_wav",e.GATHER="gather_wav",e.HAIR="hair_wav",e.MIOW_1="miow_1_wav",e.UPGRADE="upgrade_wav",e.USEITEM="useitem_wav",e.BARK_1="bark_1_wav",e.EFFECT_BTN="btn_wav",e.CHOSE="chosepet_wav",e.BATTLE_BG="battle_bg_mp3",e}(egret.EventDispatcher);egret.registerClass(SoundMgr,"SoundMgr");var LoadingUI=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e),n=i.prototype;return n.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},n.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onAddToStage=function(t){GameConst.StageH=this.stage.stageHeight,GameConst.StageW=this.stage.stageWidth,this.stage.frameRate=60,this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),this.stage.addEventListener(egret.Event.RESIZE,this.stageResize,this),RES.loadConfig("resource/resource.json","resource/")},n.stageResize=function(t){GameConst.StageH=this.stage.stageHeight,GameConst.StageW=this.stage.stageWidth},n.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},n.onResourceLoadComplete=function(t){RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),this.createScene())},n.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},n.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},n.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},n.createScene=function(){this.grayMask=new egret.Shape,this.grayMask.graphics.beginFill(0,.6),this.grayMask.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),this.grayMask.graphics.endFill(),this.addChild(this.grayMask),this.grayMask.visible=!1,this.grayMask.touchEnabled=!0,GameConst.GrayMask=this.grayMask,GameConst.Stage=this.stage;var t=new egret.DisplayObjectContainer;this.addChild(t),this.addChild(GameMain.instance())},e}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");